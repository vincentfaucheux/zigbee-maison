<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rez de chaussÃ©e</title>
    <style>
      header {
        display: flex;
        flex-direction: column; /* Aligne verticalement */
        align-items: left; /* Centre horizontalement */
        text-align: center;
        margin: 20px;
      }

      header svg {
        margin: 20px 0; /* Espace autour du dessin */
      }

      header a {
        text-decoration: none;
        color: blue;
        margin-top: 10px;
      }

      body {
        font-family: sans-serif;
      }
      .radiateur {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px;
        cursor: pointer;
        /*-- remove --*/
        /*width: 200px;*/
        /*-- end remove --*/
        text-align: center;
        display: inline-block;
      }

      /* FenÃªtre modale */
      .modal {
        display: none;
        position: fixed;
        z-index: 10;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      .modal-content {
        background: #fff;
        margin: 10% auto;
        padding: 20px;
        width: 300px;
        border-radius: 8px;
        text-align: center;
      }
      .close {
        color: red;
        float: right;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Rez de chaussÃ©e</h1>

      <!-- plan du rez de chaussee -->
      <svg width="600" height="600">
        <!-- murs extÃ©rieurs -->
        <line
          x1="50"
          y1="550"
          x2="550"
          y2="550"
          stroke="black"
          stroke-width="4"
        />
        <!-- devant -->
        <line
          x1="50"
          y1="200"
          x2="50"
          y2="550"
          stroke="black"
          stroke-width="4"
        />
        <!-- gauche -->
        <line
          x1="550"
          y1="50"
          x2="550"
          y2="550"
          stroke="black"
          stroke-width="4"
        />
        <!-- droit -->
        <line
          x1="50"
          y1="200"
          x2="275"
          y2="200"
          stroke="black"
          stroke-width="4"
        />
        <!-- jardin salle -->
        <line
          x1="275"
          y1="50"
          x2="275"
          y2="200"
          stroke="black"
          stroke-width="4"
        />
        <!-- renfoncement salon -->
        <line
          x1="275"
          y1="50"
          x2="550"
          y2="50"
          stroke="black"
          stroke-width="4"
        />
        <!-- jardin chambre -->

        <!-- cloisons garage -->
        <line
          x1="325"
          y1="375"
          x2="325"
          y2="550"
          stroke="black"
          stroke-width="2"
        />
        <!-- vertical -->
        <line
          x1="325"
          y1="375"
          x2="550"
          y2="375"
          stroke="black"
          stroke-width="2"
        />
        <!-- horizontal -->
        <!-- cloisons salle de bain / chambre-->
        <line
          x1="425"
          y1="300"
          x2="425"
          y2="375"
          stroke="black"
          stroke-width="2"
        />
        <!-- vertical -->
        <line
          x1="375"
          y1="300"
          x2="550"
          y2="300"
          stroke="black"
          stroke-width="2"
        />
        <!-- horizontal -->
        <line
          x1="375"
          y1="50"
          x2="375"
          y2="300"
          stroke="black"
          stroke-width="2"
        />
        <!-- vertical -->
        <!-- cloisons cuisine -->
        <line
          x1="250"
          y1="400"
          x2="250"
          y2="550"
          stroke="black"
          stroke-width="2"
        />
        <!-- vertical -->
        <line
          x1="50"
          y1="400"
          x2="250"
          y2="400"
          stroke="black"
          stroke-width="2"
        />
        <!-- horizontal -->

        <!-- Noms des piÃ¨ces -->
        <text x="150" y="300">Salle / Salon</text>
        <text x="130" y="475">Cuisine</text>
        <text x="430" y="200">Chambre</text>
        <text x="430" y="335">Salle de bain</text>

        <!-- radiateurs -->
        <!--
      <rect class="radiateur" x="70" y="200" width="30" height="10" rx="3" fill="orange"/>  salle jardin -->
        <!--
      <rect class="radiateur" x="325" y="50" width="30" height="10" rx="3" fill="orange"/>  salon jardin -->
        <!--
      <rect class="radiateur" x="200" y="390" width="30" height="10" rx="3" fill="orange"/>  salle cuisine -->
        <!--
      <rect class="radiateur" x="240" y="410" width="10" height="30" rx="3" fill="orange"/>  cuisine -->
        <!--
      <rect class="radiateur" x="500" y="50" width="30" height="10" rx="3" fill="orange"/>  chambre -->
        <!--
      <rect class="radiateur" x="315" y="500" width="10" height="30" rx="3" fill="orange"/>  entrÃ©e -->
        <!--
      <rect class="radiateur" x="540" y="325" width="10" height="30" rx="3" fill="orange"/>  Salle de bain -->



      
        <!-- new -->
        {% for r in radiateurs %}
        <rect
          class="radiateur"
          data-id="{{ r.id }}"
          data-nom="{{ r.nom }}"
          data-temp="{{ r.temp }}"
          x="{{ r.x }}"
          y="{{ r.y }}"
          width="{{ r.width }}"
          height="{{ r.height }}"
          rx="3"
          fill="orange"
        />
        {% endfor %}
      </svg>

      <!-- new -->
      <!--
    <div id="radiateurs">
    {% for r in radiateurs %}
        <div class="radiateur" data-id="{{ r.id }}" data-nom="{{ r.nom }}" data-temp="{{ r.temp }}"/>
            ðŸ”¥ {{ r.nom }}<br>
            TempÃ©rature : {{ r.temp }} Â°C
        </div>
    {% endfor %}
</div>
            -->

      <!-- FenÃªtre modale -->
      <div id="modal" class="modal">
        <div class="modal-content">
          <span class="close" id="closeModal">&times;</span>
          <h2 id="nomRadiateur"></h2>
          <p>TempÃ©rature actuelle : <span id="tempRadiateur"></span> Â°C</p>
          <input type="number" id="newTemp" min="5" max="30" step="0.5" />
          <button id="applyTemp">Appliquer</button>
        </div>
      </div>

      <script>
        const modal = document.getElementById("modal");
        const nomRadiateur = document.getElementById("nomRadiateur");
        const tempRadiateur = document.getElementById("tempRadiateur");
        const newTemp = document.getElementById("newTemp");
        const applyTemp = document.getElementById("applyTemp");

        document.querySelectorAll(".radiateur").forEach((el) => {
          el.addEventListener("click", () => {
            nomRadiateur.textContent = el.dataset.nom;
            tempRadiateur.textContent = el.dataset.temp;
            newTemp.value = el.dataset.temp;
            modal.style.display = "block";
          });
        });

        document.getElementById("closeModal").onclick = () => {
          modal.style.display = "none";
        };

        window.onclick = (event) => {
          if (event.target === modal) modal.style.display = "none";
        };

        applyTemp.onclick = () => {
          const targetEl = document.querySelector(
            `.radiateur[data-nom="${nomRadiateur.textContent}"]`
          );
          const radiateurId = targetEl ? targetEl.dataset.id : null;
          if (!radiateurId) {
            alert("Impossible de trouver l'ID du radiateur.");
            modal.style.display = "none";
            return;
          }

          fetch(
            `/radiateur/${encodeURIComponent(radiateurId)}/set-temperature`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ temp: parseFloat(newTemp.value) }),
            }
          )
            .then((res) => {
              if (!res.ok) throw new Error("Erreur rÃ©seau");
              return res.json().catch(() => ({}));
            })
            .then((data) => {
              // Met Ã  jour l'affichage et le dataset local
              if (targetEl) targetEl.dataset.temp = newTemp.value;
              tempRadiateur.textContent = newTemp.value;
              alert(`TempÃ©rature mise Ã  jour : ${newTemp.value} Â°C`);
              modal.style.display = "none";
            })
            .catch((err) => {
              console.error(err);
              alert("Ã‰chec de la mise Ã  jour de la tempÃ©rature.");
            });
        };
      </script>
      <!-- end new -->

      <a href="/">Home</a>
    </header>
  </body>
</html>
